From 8b44d1c81bb78db6930ea7a6eecdf0210e95b084 Mon Sep 17 00:00:00 2001
From: PJ Reiniger <pj.reiniger@gmail.com>
Date: Sat, 4 Jan 2025 12:04:50 -0500
Subject: [PATCH] Hand fixes

---
 .../bazel/deps/download_external_archives.bzl |  7 +++
 .../bazel/deps/setup_dependencies.bzl         |  8 ++--
 .../feedforward/ArmFeedForwardProperty.java   | 33 ++------------
 .../ElevatorFeedForwardProperty.java          | 27 +-----------
 .../ArmFeedForwardPropertyTest.java           | 17 -------
 .../ElevatorFeedForwardPropertyTest.java      | 44 -------------------
 .../properties/pid/RevPidPropertyBuilder.java |  5 ++-
 .../recycle_rush/robot/subsystems/BUILD.bazel |  2 +-
 .../infinite_recharge/subsystems/BUILD.bazel  |  2 +-
 .../mepi/rapid_react/subsystems/BUILD.bazel   |  2 +-
 10 files changed, 22 insertions(+), 125 deletions(-)

diff --git a/build_scripts/bazel/deps/download_external_archives.bzl b/build_scripts/bazel/deps/download_external_archives.bzl
index 40f593ae..95e682ff 100644
--- a/build_scripts/bazel/deps/download_external_archives.bzl
+++ b/build_scripts/bazel/deps/download_external_archives.bzl
@@ -15,6 +15,13 @@ def download_external_archives():
         strip_prefix = "rules_jvm_external-5.3",
         url = "https://github.com/bazelbuild/rules_jvm_external/releases/download/5.3/rules_jvm_external-5.3.tar.gz",
     )
+    
+    http_archive(
+        name = "bzlmodrio-studica",
+        sha256 = "530fb5c88def87fe86db491c8e61fe73fb5435330f831d39723b379817777ad6",
+        strip_prefix = "bzlmodRio-studica-b190c1fcfaf6e2fd242e934c5109a1073ff84082",
+        urls = ["https://github.com/bzlmodrio/bzlmodRio-studica/archive/b190c1fcfaf6e2fd242e934c5109a1073ff84082.tar.gz"],
+    )
 
     # Download bzlmodrio <3
     BZLMODRIO_COMMITISH = "882241d7676b1f8238af66f31306a1d7cb3e1762"
diff --git a/build_scripts/bazel/deps/setup_dependencies.bzl b/build_scripts/bazel/deps/setup_dependencies.bzl
index 51ea1e15..8b2b1ece 100644
--- a/build_scripts/bazel/deps/setup_dependencies.bzl
+++ b/build_scripts/bazel/deps/setup_dependencies.bzl
@@ -18,10 +18,10 @@ def setup_dependencies():
 
     download_dependencies(
         allwpilib_version = WPILIB_VERSION,
-        apriltaglib_version = None,
-        imgui_version = None,
-        libssh_version = None,
-        navx_version = NAVX_FRC_VERSION,
+        # apriltaglib_version = None,
+        # imgui_version = None,
+        # libssh_version = None,
+        studica_version = NAVX_FRC_VERSION,
         phoenix_version = PHOENIX_VERSION,
         phoenix6_version = PHOENIX6_VERSION,
         revlib_version = REVLIB_VERSION,
diff --git a/libraries/GirlsOfSteelLib/src/main/java/com/gos/lib/properties/feedforward/ArmFeedForwardProperty.java b/libraries/GirlsOfSteelLib/src/main/java/com/gos/lib/properties/feedforward/ArmFeedForwardProperty.java
index 4ffa847e..da8bf02c 100644
--- a/libraries/GirlsOfSteelLib/src/main/java/com/gos/lib/properties/feedforward/ArmFeedForwardProperty.java
+++ b/libraries/GirlsOfSteelLib/src/main/java/com/gos/lib/properties/feedforward/ArmFeedForwardProperty.java
@@ -1,9 +1,6 @@
 package com.gos.lib.properties.feedforward;
 
 import edu.wpi.first.math.controller.ArmFeedforward;
-import edu.wpi.first.units.measure.Angle;
-import edu.wpi.first.units.measure.AngularVelocity;
-import edu.wpi.first.units.measure.Voltage;
 
 public class ArmFeedForwardProperty extends BaseFeedForwardProperty {
 
@@ -55,33 +52,9 @@ public class ArmFeedForwardProperty extends BaseFeedForwardProperty {
         return m_feedForward.calculate(positionRadians, velocityRadPerSec, accelRadPerSecSquared);
     }
 
-    /**
-     * Calculates the feedforward from the gains and setpoints assuming discrete control when the
-     * velocity does not change.
-     *
-     * @param currentAngle The current angle. This angle should be measured from the horizontal (i.e.
-     *     if the provided angle is 0, the arm should be parallel to the floor). If your encoder does
-     *     not follow this convention, an offset should be added.
-     * @param currentVelocity The current velocity.
-     * @return The computed feedforward in volts.
-     */
-    public Voltage calculate(Angle currentAngle, AngularVelocity currentVelocity) {
-        return m_feedForward.calculate(currentAngle, currentVelocity);
-    }
-
-    /**
-     * Calculates the feedforward from the gains and setpoints assuming discrete control.
-     *
-     * @param currentAngle The current angle. This angle should be measured from the horizontal (i.e.
-     *     if the provided angle is 0, the arm should be parallel to the floor). If your encoder does
-     *     not follow this convention, an offset should be added.
-     * @param currentVelocity The current velocity setpoint.
-     * @param nextVelocity The next velocity setpoint.
-     * @return The computed feedforward in volts.
-     */
-    public Voltage calculate(
-        Angle currentAngle, AngularVelocity currentVelocity, AngularVelocity nextVelocity) {
-        return m_feedForward.calculate(currentAngle, currentVelocity, nextVelocity);
+    public double calculateWithVelocities(
+        double currentAngle, double currentVelocity, double nextVelocity) {
+        return m_feedForward.calculateWithVelocities(currentAngle, currentVelocity, nextVelocity);
     }
 
     public double getKs() {
diff --git a/libraries/GirlsOfSteelLib/src/main/java/com/gos/lib/properties/feedforward/ElevatorFeedForwardProperty.java b/libraries/GirlsOfSteelLib/src/main/java/com/gos/lib/properties/feedforward/ElevatorFeedForwardProperty.java
index a1f227d5..7c146286 100644
--- a/libraries/GirlsOfSteelLib/src/main/java/com/gos/lib/properties/feedforward/ElevatorFeedForwardProperty.java
+++ b/libraries/GirlsOfSteelLib/src/main/java/com/gos/lib/properties/feedforward/ElevatorFeedForwardProperty.java
@@ -1,8 +1,6 @@
 package com.gos.lib.properties.feedforward;
 
 import edu.wpi.first.math.controller.ElevatorFeedforward;
-import edu.wpi.first.units.measure.LinearVelocity;
-import edu.wpi.first.units.measure.Voltage;
 
 public class ElevatorFeedForwardProperty extends BaseFeedForwardProperty {
 
@@ -48,34 +46,13 @@ public class ElevatorFeedForwardProperty extends BaseFeedForwardProperty {
         return m_feedForward.calculate(velocity, acceleration);
     }
 
-    @SuppressWarnings("removal")
     @Deprecated(forRemoval = true, since = "2025")
     public double calculate(double velocity) {
         return m_feedForward.calculate(velocity);
     }
 
-    /**
-     * Calculates the feedforward from the gains and setpoints assuming discrete control when the
-     * setpoint does not change.
-     *
-     * @param currentVelocity The velocity setpoint.
-     * @return The computed feedforward.
-     */
-    public Voltage calculate(LinearVelocity currentVelocity) {
-        return m_feedForward.calculate(currentVelocity);
-    }
-
-    /**
-     * Calculates the feedforward from the gains and setpoints assuming discrete control.
-     *
-     * <p>Note this method is inaccurate when the velocity crosses 0.
-     *
-     * @param currentVelocity The current velocity setpoint.
-     * @param nextVelocity The next velocity setpoint.
-     * @return The computed feedforward.
-     */
-    public Voltage calculate(LinearVelocity currentVelocity, LinearVelocity nextVelocity) {
-        return m_feedForward.calculate(currentVelocity, nextVelocity);
+    public double calculateWithVelocities(double currentVelocity, double nextVelocity) {
+        return m_feedForward.calculateWithVelocities(currentVelocity, nextVelocity);
     }
 
     public double getKs() {
diff --git a/libraries/GirlsOfSteelLib/src/test/java/com/gos/lib/properties/feedforward/ArmFeedForwardPropertyTest.java b/libraries/GirlsOfSteelLib/src/test/java/com/gos/lib/properties/feedforward/ArmFeedForwardPropertyTest.java
index 782bc635..d95d3071 100644
--- a/libraries/GirlsOfSteelLib/src/test/java/com/gos/lib/properties/feedforward/ArmFeedForwardPropertyTest.java
+++ b/libraries/GirlsOfSteelLib/src/test/java/com/gos/lib/properties/feedforward/ArmFeedForwardPropertyTest.java
@@ -4,9 +4,6 @@ import com.gos.lib.properties.BasePropertiesTest;
 import edu.wpi.first.wpilibj.Preferences;
 import org.junit.jupiter.api.Test;
 
-import static edu.wpi.first.units.Units.Radians;
-import static edu.wpi.first.units.Units.RadiansPerSecond;
-import static edu.wpi.first.units.Units.Volts;
 import static org.junit.jupiter.api.Assertions.assertEquals;
 
 public class ArmFeedForwardPropertyTest extends BasePropertiesTest {
@@ -112,18 +109,4 @@ public class ArmFeedForwardPropertyTest extends BasePropertiesTest {
                 + property.getKa() * 1.3,
             property.calculate(Math.toRadians(45), -2, 1.3));
     }
-
-    @Test
-    public void testCalculate() {
-        ArmFeedForwardProperty property = new ArmFeedForwardProperty(PROPERTY_NAME, true)
-            .addKff(1.5)
-            .addKs(0.5)
-            .addKg(1)
-            .addKa(2);
-
-        assertEquals(
-            0.5, property.calculate(Radians.of(Math.PI / 3), RadiansPerSecond.of(0)).in(Volts), 0.002);
-        assertEquals(
-            2.5, property.calculate(Radians.of(Math.PI / 3), RadiansPerSecond.of(1)).in(Volts), 0.002);
-    }
 }
diff --git a/libraries/GirlsOfSteelLib/src/test/java/com/gos/lib/properties/feedforward/ElevatorFeedForwardPropertyTest.java b/libraries/GirlsOfSteelLib/src/test/java/com/gos/lib/properties/feedforward/ElevatorFeedForwardPropertyTest.java
index a614ae25..b0da8be5 100644
--- a/libraries/GirlsOfSteelLib/src/test/java/com/gos/lib/properties/feedforward/ElevatorFeedForwardPropertyTest.java
+++ b/libraries/GirlsOfSteelLib/src/test/java/com/gos/lib/properties/feedforward/ElevatorFeedForwardPropertyTest.java
@@ -1,12 +1,9 @@
 package com.gos.lib.properties.feedforward;
 
 import com.gos.lib.properties.BasePropertiesTest;
-import edu.wpi.first.units.Units;
 import edu.wpi.first.wpilibj.Preferences;
 import org.junit.jupiter.api.Test;
 
-import static edu.wpi.first.units.Units.MetersPerSecond;
-import static edu.wpi.first.units.Units.Volts;
 import static org.junit.jupiter.api.Assertions.assertEquals;
 
 public class ElevatorFeedForwardPropertyTest extends BasePropertiesTest {
@@ -77,45 +74,4 @@ public class ElevatorFeedForwardPropertyTest extends BasePropertiesTest {
         assertEquals(property.getKs() + property.getKg() + property.getKFf() * 2 + 1.3 * property.getKa(), property.calculate(2, 1.3));
         assertEquals(-property.getKs() + property.getKg() + property.getKFf() * -2 + 1.3 * property.getKa(), property.calculate(-2, 1.3));
     }
-
-
-    @Test
-    public void testCalculateWithCurrentVelocityNoKa() {
-        ElevatorFeedForwardProperty property = new ElevatorFeedForwardProperty(PROPERTY_NAME, true)
-            .addKff(1)
-            .addKs(2)
-            .addKg(4);
-
-        assertEquals(
-            Units.Volt.of(property.getKs() + property.getKg() + property.getKFf() * 2),
-            property.calculate(MetersPerSecond.of(2)));
-        assertEquals(Units.Volt.of(-property.getKs() + property.getKg() + property.getKFf() * -2),
-            property.calculate(MetersPerSecond.of(-2)));
-
-        assertEquals(
-            Units.Volt.of(property.getKs() + property.getKg() + property.getKFf() * 1.3),
-            property.calculate(
-                MetersPerSecond.of(2),
-                MetersPerSecond.of(1.3)));
-        assertEquals(
-            Units.Volt.of(property.getKs() + property.getKg() + property.getKFf() * 1.3),
-            property.calculate(
-                MetersPerSecond.of(-2),
-                MetersPerSecond.of(1.3)));
-    }
-
-    @Test
-    public void testCalculate() {
-        ElevatorFeedForwardProperty property = new ElevatorFeedForwardProperty(PROPERTY_NAME, true)
-            .addKff(1.5)
-            .addKs(0.5)
-            .addKg(1)
-            .addKa(2);
-
-
-        assertEquals(
-            105.2518749929687,
-            property.calculate(MetersPerSecond.of(2.0), MetersPerSecond.of(3.0)).in(Volts),
-            0.002);
-    }
 }
diff --git a/libraries/GirlsOfSteelLibRev/src/main/java/com/gos/lib/rev/properties/pid/RevPidPropertyBuilder.java b/libraries/GirlsOfSteelLibRev/src/main/java/com/gos/lib/rev/properties/pid/RevPidPropertyBuilder.java
index 9ce3c7a5..784e7e90 100644
--- a/libraries/GirlsOfSteelLibRev/src/main/java/com/gos/lib/rev/properties/pid/RevPidPropertyBuilder.java
+++ b/libraries/GirlsOfSteelLibRev/src/main/java/com/gos/lib/rev/properties/pid/RevPidPropertyBuilder.java
@@ -2,6 +2,7 @@ package com.gos.lib.rev.properties.pid;
 
 import com.gos.lib.properties.pid.IPidPropertyBuilder;
 import com.gos.lib.properties.pid.PidProperty;
+import com.revrobotics.spark.ClosedLoopSlot;
 import com.revrobotics.spark.SparkBase;
 import com.revrobotics.spark.SparkBase.PersistMode;
 import com.revrobotics.spark.SparkBase.ResetMode;
@@ -16,9 +17,9 @@ public final class RevPidPropertyBuilder extends PidProperty.Builder implements
     private final SparkBase m_motor;
     private final SparkBaseConfig m_parentConfig;
     private final ClosedLoopConfig m_closedLoopConfig;
-    private final ClosedLoopConfig.ClosedLoopSlot m_slot;
+    private final ClosedLoopSlot m_slot;
 
-    public RevPidPropertyBuilder(String baseName, boolean isConstant, SparkBase motor, SparkBaseConfig parentConfig, ClosedLoopConfig.ClosedLoopSlot slot) {
+    public RevPidPropertyBuilder(String baseName, boolean isConstant, SparkBase motor, SparkBaseConfig parentConfig, ClosedLoopSlot slot) {
         super(baseName, isConstant);
         m_motor = motor;
         m_parentConfig = parentConfig;
diff --git a/old_robots/y2015/GoS2015/src/main/java/com/gos/recycle_rush/robot/subsystems/BUILD.bazel b/old_robots/y2015/GoS2015/src/main/java/com/gos/recycle_rush/robot/subsystems/BUILD.bazel
index b47e8aed..05f15b39 100644
--- a/old_robots/y2015/GoS2015/src/main/java/com/gos/recycle_rush/robot/subsystems/BUILD.bazel
+++ b/old_robots/y2015/GoS2015/src/main/java/com/gos/recycle_rush/robot/subsystems/BUILD.bazel
@@ -9,7 +9,7 @@ gos_java_library(
         "@bzlmodrio-allwpilib//libraries/java/wpilibNewCommands",
         "@bzlmodrio-allwpilib//libraries/java/wpilibj",
         "@bzlmodrio-allwpilib//libraries/java/wpimath",
-        "@bzlmodrio-navx//libraries/java/navx",
+        "@bzlmodrio-studica//libraries/java/studica-java",
         "@bzlmodrio-phoenix//libraries/java/api-java",
         "@bzlmodrio-phoenix//libraries/java/wpiapi-java",
     ],
diff --git a/old_robots/y2020/2020InfiniteRecharge/src/main/java/com/gos/infinite_recharge/subsystems/BUILD.bazel b/old_robots/y2020/2020InfiniteRecharge/src/main/java/com/gos/infinite_recharge/subsystems/BUILD.bazel
index 87b61742..d81162c3 100644
--- a/old_robots/y2020/2020InfiniteRecharge/src/main/java/com/gos/infinite_recharge/subsystems/BUILD.bazel
+++ b/old_robots/y2020/2020InfiniteRecharge/src/main/java/com/gos/infinite_recharge/subsystems/BUILD.bazel
@@ -17,7 +17,7 @@ gos_java_library(
         "@bzlmodrio-allwpilib//libraries/java/wpilibNewCommands",
         "@bzlmodrio-allwpilib//libraries/java/wpilibj",
         "@bzlmodrio-allwpilib//libraries/java/wpimath",
-        "@bzlmodrio-navx//libraries/java/navx",
+        "@bzlmodrio-studica//libraries/java/studica-java",
         "@bzlmodrio-phoenix//libraries/java/api-java",
         "@bzlmodrio-phoenix//libraries/java/wpiapi-java",
         "@bzlmodrio-revlib//libraries/java/revlib-java",
diff --git a/old_robots/y2022/MEPI/src/main/java/com/scra/mepi/rapid_react/subsystems/BUILD.bazel b/old_robots/y2022/MEPI/src/main/java/com/scra/mepi/rapid_react/subsystems/BUILD.bazel
index 84943b52..5ffb460b 100644
--- a/old_robots/y2022/MEPI/src/main/java/com/scra/mepi/rapid_react/subsystems/BUILD.bazel
+++ b/old_robots/y2022/MEPI/src/main/java/com/scra/mepi/rapid_react/subsystems/BUILD.bazel
@@ -19,7 +19,7 @@ gos_java_library(
         "@bzlmodrio-allwpilib//libraries/java/wpilibNewCommands",
         "@bzlmodrio-allwpilib//libraries/java/wpilibj",
         "@bzlmodrio-allwpilib//libraries/java/wpimath",
-        "@bzlmodrio-navx//libraries/java/navx",
+        "@bzlmodrio-studica//libraries/java/studica-java",
         "@bzlmodrio-pathplannerlib//libraries/java/pathplannerlib-java",
         "@bzlmodrio-revlib//libraries/java/revlib-java",
         "@maven//:org_snobotv2_snobot_sim_java_base",
-- 
2.34.1

